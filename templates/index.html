<!DOCTYPE html>
<html>
	
<head>
	<style>
		body {
      	background-color: #1f1f1f;
      	color: white;
  		}
	</style>
    <title>Currency Converter</title>
</head>

<body>
	<style>
		button {
		background-color: #3b3b3b;
      	color: white;
      	border: none;
      	font-size: 34px;
      	padding: 20px 30px;
      	margin: 5px;
		border-radius: 5px;
  		}

		select {
      	background-color: #3b3b3b;
      	color: white;
      	border: none;
      	font-size: 16px;
      	padding: 10px;
      	border-radius: 5px;
		margin-bottom: 10px;
  		}

  		input {
      	background-color: #3b3b3b;
      	color: white;
      	border: none;
      	font-size: 24px;
      	padding: 10px;
      	border-radius: 5px;
		width: 200px;
		margin-bottom: 10px;
  		}

		.numpad{ 
			display: grid;
			grid-template-columns: 1fr 1fr 1fr;
			width: 350px;
			gap: 2px;
		 }

		.converter-layout {
     		display: grid;
      		grid-template-columns: 1fr 1fr;
      		gap: 50px;
			align-items: start;
  		}

  		label {
      	display: block;
      	margin-top: 15px;
  		}
	</style>


    <h1>Currency Converter</h1>
    <p>Convert your currencies here!</p>

{%if api_error%}
<p> {{api_error}} </p>
{% endif %}

<div class="converter-layout">
    <div class="currency-section">
        <label>Amount:</label>
		 <span id="fromSymbol">$</span>
        <input type="text" value="{{ amount or '' }}" name="amount" id="amount">

        <label>From Currency:</label>
        <select name="from_currency" id="from_currency">
            {% for currency in cached_rates.conversion_rates %}
            <option value = "{{ currency }}" {% if from_currency == currency %}selected{% endif %}>{{ currency_info[currency]["name"] }}: {{ currency }}</option>
            {% endfor %}
        </select>

		<br>
		<br>

        <label>Converted Amount:</label>
		 <span id="toSymbol">$</span>
        <input type="text" value="{{ result or '' }}" id="convAmount">

        <label>To Currency:</label>
        <select name="to_currency" id="to_currency">
            {% for currency in cached_rates.conversion_rates %}
            <option value = "{{ currency }}" {% if to_currency == currency %}selected{% endif %}>{{ currency_info[currency]["name"] }}: {{ currency }}</option>
            {% endfor %}
        </select>

        <p id="dynamic">1 USD = 1 USD</p>
        <p>Last Updated: {{formatted_time}}</p>
    </div>

    <div class="numpad">
        <button id="btn7">7</button>
        <button id="btn8">8</button>
        <button id="btn9">9</button>
        <button id="btn4">4</button>
        <button id="btn5">5</button>
        <button id="btn6">6</button>
        <button id="btn1">1</button>
        <button id="btn2">2</button>
        <button id="btn3">3</button>
        <button id="btn0">0</button>
        <button id="dec">.</button>
        <button id="btnClear">CE</button>
		<button id="back">âŒ«</button>
    </div>
</div>

<script>

const currencyInfo = {{currency_info | tojson}};
console.log(currencyInfo)

const rates = {{cached_rates | tojson}};
console.log(rates);


function liveCalc() {
	let amount = document.getElementById("amount").value;
	console.log(amount);

	if (amount === "") {
      document.getElementById("convAmount").value = "";
      return;
  }

	let fromValue = document.getElementById("from_currency").value;
	console.log(fromValue);

	let toValue = document.getElementById("to_currency").value;
	console.log(toValue);

	let rate = (1 / rates.conversion_rates[fromValue] * rates.conversion_rates[toValue]);
	console.log(rate);

	let result = parseFloat(amount) * rate

	document.getElementById("convAmount").value = result.toFixed(2)
}

document.getElementById("amount").addEventListener("input", liveCalc)

function updateRate() {
	let fromValue = document.getElementById("from_currency").value;
	console.log(fromValue);

	let toValue = document.getElementById("to_currency").value;
	console.log(toValue);

	let rate = (1 / rates.conversion_rates[fromValue] * rates.conversion_rates[toValue]);
	console.log(rate);

	document.getElementById("dynamic").textContent = "1 " + fromValue + "= " + rate.toFixed(2) + " " + toValue;
	liveCalc()

	document.getElementById("toSymbol").textContent = currencyInfo[toValue]["symbol"]
	document.getElementById("fromSymbol").textContent = currencyInfo[fromValue]["symbol"]

}

document.getElementById("from_currency").addEventListener("change", updateRate, liveCalc);
document.getElementById("to_currency").addEventListener("change", updateRate, liveCalc);


 let digits = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0",];
  for (let num of digits) {
      document.getElementById("btn" + num).addEventListener("click", function() {
          let currentValue = document.getElementById("amount").value;
          console.log(currentValue);
          let newValue = currentValue + num;
          console.log(newValue);
          document.getElementById("amount").value = newValue;
          liveCalc();
      });
  }


document.getElementById("dec").addEventListener("click", function() {

	document.getElementById("amount").value;
	let currentValue = document.getElementById("amount").value;
	console.log(currentValue)
	let newValue = currentValue + "."
	console.log(currentValue)
	document.getElementById("amount").value = newValue;
	liveCalc();
})

document.getElementById("back").addEventListener("click", function(){

	let currentValue = document.getElementById("amount").value;
	console.log(currentValue)
	let newValue = currentValue.slice(0, -1)
	console.log(newValue)
	document.getElementById("amount").value = newValue;
	liveCalc()
})


document.getElementById("btnClear").addEventListener("click", function() {
	
	  document.getElementById("amount").value = "";
	  document.getElementById("convAmount").value = "";
	});
	  


updateRate()
  
</script>
</body>
</html>